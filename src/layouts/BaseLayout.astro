---
import 'uno.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

const { title, description, bodyClass } = Astro.props;
const pageTitle = title ? `${title} · ${SITE_TITLE}` : SITE_TITLE;
const pageDescription = description ?? SITE_DESCRIPTION;
const bodyClassName = bodyClass ? String(bodyClass) : '';
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    <style is:global>
      html:not(.dark) body {
        background-color: #f1f0ea;
      }
      .post-link {
        color: inherit;
        text-decoration: none;
      }
      .post-link:visited {
        color: inherit;
      }
      .report-link {
        color: inherit;
        text-decoration: none;
      }
      .report-link:visited {
        color: inherit;
      }
      .report-link:hover,
      .report-link:focus-visible {
        text-decoration: underline;
        text-underline-offset: 0.25em;
      }
      .report-page {
        background: transparent;
      }
      .report-body {
        background-color: #f1f0ea;
        background-image: radial-gradient(circle at 15% 15%, rgba(210, 205, 190, 0.35), transparent 55%),
          radial-gradient(circle at 80% 10%, rgba(190, 200, 210, 0.25), transparent 55%),
          radial-gradient(circle at 30% 85%, rgba(215, 210, 190, 0.25), transparent 50%);
      }
      .report-card {
        border: 1px solid rgba(155, 150, 135, 0.25);
        background: rgba(246, 245, 240, 0.72);
        box-shadow: 0 18px 45px rgba(40, 36, 28, 0.06);
      }
      html.dark .report-card {
        border-color: rgba(120, 120, 120, 0.4);
        background: rgba(24, 24, 27, 0.6);
        box-shadow: none;
      }
      html.dark .report-body {
        background-color: #09090b;
        background-image: radial-gradient(circle at 20% 20%, rgba(40, 40, 45, 0.35), transparent 55%),
          radial-gradient(circle at 70% 0%, rgba(30, 35, 45, 0.25), transparent 55%),
          radial-gradient(circle at 30% 85%, rgba(30, 30, 40, 0.25), transparent 50%);
      }
      .post-title {
        display: inline-flex;
        align-items: baseline;
        gap: 0.4rem;
        position: relative;
      }
      .post-title::after {
        content: '';
        position: absolute;
        left: 0;
        right: 0;
        bottom: -0.3em;
        height: 1px;
        background: currentColor;
        opacity: 0;
        transform: scaleX(0.65);
        transform-origin: left;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }
      .post-link:hover .post-title::after,
      .post-link:focus-visible .post-title::after {
        opacity: 0.55;
        transform: scaleX(1);
      }
    </style>
    <script is:inline>
      const storageKey = 'theme';
      const classList = document.documentElement.classList;
      const stored = localStorage.getItem(storageKey);
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (stored === 'dark' || (!stored && prefersDark)) {
        classList.add('dark');
      }
    </script>
  </head>
  <body class={`min-h-screen bg-[#f1f0ea] font-sans text-zinc-900 antialiased dark:bg-zinc-950 dark:text-zinc-100 ${bodyClassName}`}>
    <div class="flex min-h-screen flex-col">
      <Header siteTitle={SITE_TITLE} />
      <main class="flex-1">
        <slot />
      </main>
      <Footer />
    </div>
    <script type="module" is:inline>
      const storageKey = 'theme';
      const classList = document.documentElement.classList;
      const updateLabel = () => {
        const button = document.getElementById('theme-toggle');
        if (!button) return;
        const label = classList.contains('dark') ? '切换到浅色' : '切换到深色';
        button.setAttribute('aria-label', label);
        button.setAttribute('title', label);
      };
      const toggleTheme = () => {
        const next = classList.contains('dark') ? 'light' : 'dark';
        classList.toggle('dark', next === 'dark');
        localStorage.setItem(storageKey, next);
        updateLabel();
      };
      const onReady = () => {
        updateLabel();
        document.addEventListener('click', (event) => {
          const target = event.target?.closest?.('#theme-toggle');
          if (!target) return;
          toggleTheme();
        });
      };
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', onReady, { once: true });
      } else {
        onReady();
      }
    </script>
  </body>
</html>
